---
title: "M215 Project Analyses"
author: "Landi Luo"
date: "12/6/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(survival)
library(ncvreg)
library(dummies)

```

Import data
```{r}
setwd(".")
breast_ca <- readRDS(file = "breast_final.rds")
```


## Variable selection

variables:

- stage: cancer stage
- delta: death indicator
- SRV_TIME_MON = Survival months survival time
- SEX = Sex
- RAC_RECY = race
- MAR_STAT = marital status at dx
- BRST_SUB = BREAST SUBTYPE
- AGE_DX = age at diagnosis
- YR_BRTH = year of birth
- MALIGCOUNT = Total number of in situ/malignant tumors for patient       
- BENBORDCOUNT = Total number of benign/borderline tumors for patient
- Age (year of end of study - YR_BRTH)

```{r}
source("Rfunction.R")
```

The design matrix of predictor values
```{r}
X <- breast_ca %>% 
  select(-SRV_TIME_MON, -delta)

X <- as.data.frame(X)

#get dummy variables
X <- dummy.data.frame(X, names = c('stage', 'SEX', 'RAC_RECY', 'MAR_STAT', 'BRST_SUB'))
X <- select(X, -stage0, -RAC_RECY1, -SEX1, -BRST_SUB1, -MAR_STAT1)
colnames(X)[colnames(X)=="SEX2"] <- "SEX"
```

Lasso
```{r}
n <- 300
lasso.fit <- ncvsurv(X, Surv(breast_ca$SRV_TIME_MON, breast_ca$delta), penalty = "lasso", nlambda = 25)
lasso.bic <- AIC(lasso.fit, k = log(n))
lasso.est <- lasso.fit$beta[, which.min(lasso.bic)]

```

SCAD
```{r}
scad.fit <- ncvsurv(X, Surv(breast_ca$SRV_TIME_MON, breast_ca$delta), penalty = "SCAD", nlambda = 25) 
scad.bic <- AIC(scad.fit, k = log(n))
scad.est <- scad.fit$beta[, which.min(scad.bic)]
```

MCP
```{r}
mcp.fit <- ncvsurv(X, Surv(breast_ca$SRV_TIME_MON, breast_ca$delta), penalty = "MCP", nlambda = 25)
mcp.bic <- AIC(mcp.fit, k = log(n))
mcp.est <- mcp.fit$beta[, which.min(mcp.bic)]
```

Results
```{r}
beta.est <- round(cbind(lasso.est, scad.est, mcp.est), 4)
beta.est
```